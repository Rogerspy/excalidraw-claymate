(this["webpackJsonpexcalidraw-claymate"]=this["webpackJsonpexcalidraw-claymate"]||[]).push([[0],{141:function(e,n,t){"use strict";t.r(n);var a=t(0),i=t.n(a),r=t(24),o=t.n(r),c=(t(47),t(2)),l=t(7),s=t.n(l),u=(t(71),t(5)),d=t(1),m=t.n(d),f=t(4),g=t(3),b=t(39),p=(t(72),t(8)),v=t(40),h=t.n(v),y=function(e){return new Promise((function(n){var t=new h.a;e.forEach((function(n,a){var i=a+1===e.length;t.addFrame(n.imageData,{delay:i?2e3:500})})),t.on("finished",(function(e){Object(p.a)(e,{fileName:"excalidraw-claymate.gif"}).then(n)})),t.render()}))},w=t(18),x=function(e){return e.filter((function(e){return!e.isDeleted}))},O=function(){var e=Object(f.a)(m.a.mark((function e(n,t){var a,i,r,o,c,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a='<!DOCTYPE html>\n    <html lang="en">\n      <style>\n        svg { width: 100%; height: 100%; }\n        body { margin: 0px; font-size: 24px; }\n        button { background: transparent; border: none; cursor: pointer; padding: 3px; margin: 0px 10px; font-size: inherit;}\n        #container { display: flex; flex-direction: column; height: 100%; }\n        #navigation { display: flex; justify-content: center; align-items: center; padding: 5px; border-top: 1px solid lightgray; background: white; }\n        #leftbuttons { position: absolute; left: 10px; display: flex; }\n        #rightbuttons { position: absolute; right: 10px; display: flex; }\n        #slides { height: calc(100vh - 50px); }\n      </style>\n      <script>\n        let index = 0;\n        let totalScenes = '.concat(n.length,"\n        function updateTitle() {\n          document.getElementById('title').innerText = '' + (index + 1) + ' of ' + totalScenes;\n        }\n        function moveLeft() {\n          if (index > 0) {\n            document.getElementById('scene' + index).style.display = 'none';\n            index -= 1;\n            document.getElementById('scene' + index).style.display = 'block';\n            updateTitle();\n            document.getElementById('scene' + index).setCurrentTime(0);\n          }\n        }\n        function moveRight() {\n          if (index < totalScenes - 1) {\n            document.getElementById('scene' + index).style.display = 'none';\n            index += 1;\n            document.getElementById('scene' + index).style.display = 'block';\n            updateTitle();\n            document.getElementById('scene' + index).setCurrentTime(0);\n          }\n        }\n        function closeNavigation() {\n          document.getElementById('navigation').style.display = 'none';\n          document.getElementById('slides').style.height = '100vh'\n        }\n        function toggleMaximise() {\n          if (document.fullscreenElement === document.body) {\n            document.exitFullscreen();\n          } else {\n            document.body.requestFullscreen();\n          }\n        }\n        ").concat((u=!!t.animate,u?"\n      function togglePausedAnimations() {\n        const svg = document.getElementById('scene' + index);\n        if (svg.animationsPaused()) {\n          for (const svg of document.getElementsByTagName('svg')) {\n            svg.unpauseAnimations();\n          }\n        } else {\n          for (const svg of document.getElementsByTagName('svg')) {\n            svg.pauseAnimations();\n          }\n        }\n      }\n      const beginTimeLists = [];\n      let animateTimer;\n      function stepForwardAnimations() {\n        const svg = document.getElementById('scene' + index);\n        const beginTimeList = beginTimeLists[index];\n        const currentTime = svg.getCurrentTime() * 1000;\n        let nextTime = beginTimeList.find((t) => t > currentTime + 50);\n        console.log(currentTime, beginTimeList, nextTime);\n        if (nextTime) {\n          nextTime -= 1;\n        } else {\n          nextTime = currentTime + 500;\n        }\n        clearTimeout(animateTimer);\n        svg.unpauseAnimations();\n        animateTimer = setTimeout(() => {\n          svg.pauseAnimations();\n          svg.setCurrentTime(nextTime / 1000);\n        }, nextTime - currentTime);\n      }\n      function resetAnimations() {\n        const svg = document.getElementById('scene' + index);\n        svg.setCurrentTime(0);\n      }\n":"\n      function togglePausedAnimations() {}\n      function stepForwardAnimations() {}\n      function resetAnimations() {}\n"),"\n        ").concat("\n  function startRecording() {\n    import('https://unpkg.com/browser-fs-access').then(({ fileSave }) => {\n      navigator.mediaDevices.getDisplayMedia({\n        video: { displaySurface: 'browser' },\n      }).then(function(stream) {\n        navigator.mediaDevices.getUserMedia({\n          audio: true,\n        }).catch(() => null).then(function(audioStream) {\n          if (audioStream) {\n            const audioTrack = audioStream.getAudioTracks()[0];\n            stream.getVideoTracks()[0].onended = () => {\n              audioTrack.stop();\n            };\n            stream.addTrack(audioTrack);\n          }\n          const recorder = new MediaRecorder(stream);\n          recorder.ondataavailable = (e) => {\n            const blob = new Blob([e.data], { type: \"video/webm\" });\n            const opts = { fileName: \"video.webm\", extensions: [\".webm\"] };\n            fileSave(blob, opts).catch(() => {\n              document.getElementById('startrecordingbutton').onclick = () => {\n                fileSave(blob, opts);\n              };\n              window.alert('Click the recording button again to save file');\n            });\n          };\n          recorder.start();\n        });\n      });\n    });\n  }\n","\n        document.addEventListener('DOMContentLoaded', () => {\n          document.getElementById('scene' + index).style.display = 'block';\n          document.getElementById('scene' + index).setCurrentTime(0);\n        });\n        document.addEventListener('keydown', (event) => {\n          if (event.key === 'ArrowRight') {\n            moveRight();\n          }\n          if (event.key === 'ArrowLeft') {\n            moveLeft();\n          }\n          if (event.key.toLowerCase() === 'f') {\n            toggleMaximise();\n          }\n          if (event.key.toLowerCase() === 'p') {\n            togglePausedAnimations();\n          }\n          if (event.key.toLowerCase() === 's') {\n            stepForwardAnimations();\n          }\n          if (event.key.toLowerCase() === 'r') {\n            resetAnimations();\n          }\n        });\n      <\/script>\n      <body>\n      <div id=\"container\">\n      <div id=\"slides\">\n  "),i=0;case 2:if(!(i<n.length)){e.next=15;break}return r=n[i],e.next=6,Object(l.exportToSvg)(r.drawing);case 6:o=e.sent,t.animate&&Object(w.a)(o,x(r.drawing.elements),t.animateOptions),o.id="scene".concat(i),o.style.display="none",a+=o.outerHTML,t.animate&&((c=Object(w.b)(o)).sort((function(e,n){return e-n})),a+="\n        <script>\n          beginTimeLists.push(".concat(JSON.stringify(c),");\n        <\/script>\n      "));case 12:++i,e.next=2;break;case 15:return s=t.animate?'\n    <div id="leftbuttons">\n     <button type="button" onclick="togglePausedAnimations()" title="Play or pause animations">P</button>\n     <button type="button" onclick="stepForwardAnimations()" title="Step forward animations">S</button>\n     <button type="button" onclick="resetAnimations()" title="Reset animations">R</button>\n    </div>\n':"",a+='\n    </div>\n    <div id="navigation">\n      '.concat(s,'\n      <button class="navbutton" type="button" onclick="moveLeft()" title="Previous slide">&#9664;</button>\n      <div id="title">1 of ').concat(n.length,'</div>\n      <button class="navbutton" type="button" onclick="moveRight()" title="Next slide">&#9654;</button>\n      <div id="rightbuttons">\n        <button type="button" onclick="startRecording()" title="Start recording" id="startrecordingbutton">&#x1F3A5;</button>\n        <button type="button" onclick="toggleMaximise()" title="Toggle full-screen">&#x26F6;</button>\n        <button type="button" onclick="closeNavigation()" title="Close this panel">&#x2716;</button>\n      </div>\n    </div>\n  </div></body></html>\n'),e.next=19,Object(p.a)(new Blob([a],{type:"text/html"}),{fileName:"excalidraw-claymate.html"});case 19:case"end":return e.stop()}var u}),e)})));return function(n,t){return e.apply(this,arguments)}}(),E=function(){var e=Object(f.a)(m.a.mark((function e(n,t,a){var i,r,o,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.exportToSvg)(n.drawing);case 2:i=e.sent,t.animate&&Object(w.a)(i,x(n.drawing.elements),t.animateOptions),r=i.outerHTML,a?(o=document.getElementById(a))&&(o.innerHTML=r):(c=window.open("","_blank"))&&(c.document.body.innerHTML=r);case 6:case"end":return e.stop()}}),e)})));return function(n,t,a){return e.apply(this,arguments)}}(),j=(t(73),function(e,n){var t=e.match(new RegExp("".concat(n,":(-?\\d+)")));return null===t?void 0:Number(t[1])||0}),k=function(e,n,t,a){var i=Object(c.a)({},e.appState.selectedElementIds);return{elements:e.elements.map((function(e){var r,o=e.id;return n.includes(o)?(r=o.match(new RegExp("".concat(t,":(-?\\d+)")))?o.replace(new RegExp("".concat(t,":(-?\\d+)")),"".concat(t,":").concat(a)):o+"-".concat(t,":").concat(a),o===r?e:(i[r]=i[o],delete i[o],Object(c.a)(Object(c.a)({},e),{},{id:r}))):e})),appState:Object(c.a)(Object(c.a)({},e.appState),{},{selectedElementIds:i})}},S=function(e){var n,t,a=e.animateEnabled,r=e.setAnimateEnabled,o=e.scene,l=e.updateDrawing,s=e.animateOptions,u=e.setAnimateOptions,d=e.previewCurrentScene,m=null!==(n=null===o||void 0===o?void 0:o.drawing.elements)&&void 0!==n?n:[],f=o?Object.keys(null!==(t=o.drawing.appState.selectedElementIds)&&void 0!==t?t:{}).filter((function(e){return o.drawing.appState.selectedElementIds[e]&&m.some((function(n){return n.id===e}))})):[],g=new Set;f.forEach((function(e){g.add(j(e,"animateOrder"))}));var b=!a||!g.size,p=new Set;f.forEach((function(e){p.add(j(e,"animateDuration"))}));var v=!a||!p.size;return i.a.createElement("div",{className:"AnimateConfig"},i.a.createElement("div",null,i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",checked:a,onChange:function(){return r((function(e){return!e}))}}),"Enable animate")," ",i.a.createElement("button",{disabled:!a,onClick:d},"Preview")),i.a.createElement("div",{style:{opacity:b?.3:1}},"Animate order:"," ",g.size>1?i.a.createElement(i.a.Fragment,null,"(mixed)"):i.a.createElement("input",{disabled:b,value:1===g.size&&g.values().next().value||0,onChange:function(e){var n=Math.floor(Number(e.target.value));o&&Number.isFinite(n)&&l(k(o.drawing,f,"animateOrder",n))},type:"number",style:{width:40}})),i.a.createElement("div",{style:{opacity:v?.3:1}},"Animate duration (ms):"," ",p.size>1?i.a.createElement(i.a.Fragment,null,"(mixed)"):i.a.createElement("input",{disabled:v,value:1===p.size&&p.values().next().value||"",onChange:function(e){var n=Math.floor(Number(e.target.value));o&&Number.isFinite(n)&&l(k(o.drawing,f,"animateDuration",n))},placeholder:"Default",style:{width:50}})),i.a.createElement("div",{style:{opacity:a?1:.3}},"Animate pointer:"," ",i.a.createElement("input",{disabled:!a,value:s.pointerImg||"",onChange:function(e){u((function(n){return Object(c.a)(Object(c.a)({},n),{},{pointerImg:e.target.value})}))},placeholder:"URL...",style:{width:50}})," ",i.a.createElement("label",{className:"AnimateConfig-button-like ".concat(a?"AnimateConfig-button-like-enabled":"AnimateConfig-button-like-disabled")},i.a.createElement("input",{disabled:!a,type:"file",accept:"image/*",onChange:function(e){var n=e.target.files&&e.target.files[0];if(n){var t=new FileReader;t.onload=function(){if("string"===typeof t.result){var e=t.result;u((function(n){return Object(c.a)(Object(c.a)({},n),{},{pointerImg:e})}))}},t.readAsDataURL(n)}},style:{width:0}}),"File")),i.a.createElement("div",{style:{opacity:a?1:.3}},"(Pointer width:"," ",i.a.createElement("input",{disabled:!a,value:s.pointerWidth||"",onChange:function(e){u((function(n){return Object(c.a)(Object(c.a)({},n),{},{pointerWidth:e.target.value})}))},placeholder:"Num...",style:{width:50}}),")"))},C=Object(a.memo)((function(e){var n=e.scene,t=Object(a.useRef)(null);return Object(a.useEffect)((function(){if(t.current){var e=t.current.getContext("2d");e&&e.putImageData(n.imageData,0,0)}}),[n]),i.a.createElement("canvas",{ref:t,width:n.width,height:n.height})})),T=function(e){var n=e.scenes,t=e.currentIndex,r=e.updateScenes,o=e.moveToScene,c=e.addScene,l=e.updateDrawing,s=Object(a.useState)(!1),d=Object(g.a)(s,2),p=d[0],v=d[1],h=Object(a.useState)(!1),w=Object(g.a)(h,2),x=w[0],j=w[1],k=Object(a.useState)({}),T=Object(g.a)(k,2),I=T[0],A=T[1],N=function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(n);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(n,{animate:x,animateOptions:I});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(f.a)(m.a.mark((function e(){var a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t){e.next=7;break}return a="",(i=document.getElementById("previewOuter"))&&(a="previewInner"),e.next=6,E(n[t],{animate:x,animateOptions:I},a);case 6:i&&(i.style.display="block");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){0===n.length&&c()}),[n,c]),i.a.createElement("div",{className:"Claymate"},i.a.createElement("div",{className:"Claymate-scenes"},n.map((function(e,a){var c="MissingId";return Object(b.isEmpty)(n[a].drawing.elements)||(c=n[a].drawing.elements[0].id),i.a.createElement("div",{key:e.id,className:"Claymate-scene ".concat(a===t?"Claymate-current-scene":""),onClick:function(){return o(a)},"data-testid":c},i.a.createElement(C,{scene:e}),i.a.createElement("button",{type:"button",className:"Claymate-delete","aria-label":"Delete",disabled:n.length<=1,onClick:function(a){a.stopPropagation(),function(e){var a=n.findIndex((function(n){return n.id===e}));if(a>=0){var i=n.length-1;if(i>0){var o;if(void 0!==t){var c=a===t;if(t>a||c){var l=t;c&&(t===i?l=t-1:0===t&&(l=1)),o={index:t>0?t-1:t,drawing:n[l].drawing}}}r((function(n){return n.filter((function(n){return n.id!==e}))}),o)}}}(e.id)}},"\u2716"),i.a.createElement("button",{type:"button",className:"Claymate-left","aria-label":"Move Left",disabled:0===a,onClick:function(t){t.stopPropagation(),function(e){var t=n.findIndex((function(n){return n.id===e}));r((function(e){var n=Object(u.a)(e);return n[t-1]=e[t],n[t]=e[t-1],n}),{index:t-1,drawing:n[t].drawing})}(e.id)}},"\u2b05"),i.a.createElement("button",{type:"button",className:"Claymate-right","aria-label":"Move Right",disabled:a===n.length-1,onClick:function(t){t.stopPropagation(),function(e){var t=n.findIndex((function(n){return n.id===e}));r((function(e){var n=Object(u.a)(e);return n[t+1]=e[t],n[t]=e[t+1],n}),{index:t+1,drawing:n[t].drawing})}(e.id)}},"\u27a1"))}))),i.a.createElement("div",{className:"Claymate-configs"},p&&i.a.createElement(S,{animateEnabled:x,setAnimateEnabled:j,scene:void 0===t?void 0:n[t],updateDrawing:l,animateOptions:I,setAnimateOptions:A,previewCurrentScene:B})),i.a.createElement("div",{className:"Claymate-buttons"},i.a.createElement("button",{type:"button",onClick:c},"Add scene"),i.a.createElement("button",{type:"button",onClick:N,disabled:0===n.length},"Export GIF"),i.a.createElement("div",null,i.a.createElement("button",{type:"button",onClick:function(){return v((function(e){return!e}))}},p?i.a.createElement(i.a.Fragment,null,"\u25b8"):i.a.createElement(i.a.Fragment,null,"\u25c2")),i.a.createElement("button",{type:"button",onClick:function(){return L()},disabled:0===n.length},"Export HTML")),i.a.createElement("button",{type:"button",onClick:function(){r((function(e){return Object(u.a)(e).reverse()}),void 0!==t?{index:n.length-1-t,drawing:n[t].drawing}:void 0)},disabled:n.length<=1},"Reverse order")))},I=t(25),A=t.n(I),N=t(41),L=function(e,n){var t=Object(l.exportToCanvas)({elements:e.elements}),a=n?n.width:t.width,i=n?n.height:t.height;if(a&&i){var r=t.getContext("2d");return r?{id:Object(N.a)(),width:a,height:i,imageData:r.getImageData(0,0,a,i),drawing:e}:void 0}},B=function(){try{var e,n=JSON.parse(localStorage.getItem("claymate-scenes")||"");if(n&&n.length>0)return n.map((function(n){n.appState.collaborators=new Map;var t=L(n,e?{width:e.width,height:e.height}:void 0);return void 0===e&&(e=t),t}))}catch(i){try{var t=function(){try{var e=JSON.parse(localStorage.getItem("excalidraw-elements")||"");return e.appState.collaborators=new Map,e}catch(n){return null}}();if(t){var a=L(t);if(a)return[a]}}catch(r){}}return null},D=function(){var e=Object(a.useState)(!1),n=Object(g.a)(e,2),t=n[0],i=n[1],r=Object(a.useState)(0),o=Object(g.a)(r,2),l=o[0],s=o[1],d=Object(a.useState)(0),m=Object(g.a)(d,2),f=m[0],b=m[1],p=Object(a.useState)([]),v=Object(g.a)(p,2),h=v[0],y=v[1],w=Object(a.useState)(),x=Object(g.a)(w,2),O=x[0],E=x[1];Object(a.useEffect)((function(){if(!t){var e=B();e&&e.length>0&&(y(e),b(0),E(e[0].drawing))}}),[t,i]),Object(a.useEffect)((function(){!function(e){var n=JSON.stringify(e.map((function(e){return e.drawing})));localStorage.setItem("claymate-scenes",n)}(h)}),[h]);var j,k,S=Object(a.useCallback)((function(e){s((function(e){return e+1})),E(e)}),[]),C=Object(a.useCallback)((function(e){S(h[e].drawing),b(e)}),[S,b,h]),T=Object(a.useCallback)((function(e,n){y(e),n&&(S(n.drawing),b(n.index))}),[b,S,y]),I=void 0!==f&&f<h.length?Object(c.a)(Object(c.a)({},h[f]),{},{drawing:O}):void 0;null!=I&&1!==h.length&&(j=I.width,k=I.height),Object(a.useEffect)((function(){if(null!=f&&O){var e=L(O,void 0===j||void 0===k?void 0:{width:j,height:k});e&&T((function(n){var t=Object(u.a)(n);return t[f]=e,t}),void 0)}}),[O,f,h.length,T,j,k]);var N=Object(a.useCallback)((function(){if(O){var e=L(O,h[0]&&{width:h[0].width,height:h[0].height});e&&T((function(n){return[].concat(Object(u.a)(n),[e])}),{index:h.length,drawing:O})}}),[T,h,O]);return{initialised:t,moveToScene:C,addScene:N,onChange:function(e,n){if(null==O||!A()(e,O.elements)||!A()(n,O.appState)){var t={elements:e.map((function(e){return Object(c.a)({},e)})),appState:Object(c.a)({},n)};E(t)}},drawingVersion:l,currentIndex:f,scenes:h,updateScenes:T,initialData:O}},M=function(){var e=Object(a.useMemo)((function(){return function(){try{var e=localStorage.getItem("claymate-libraries"),n=e?JSON.parse(e):void 0;if(n)return n}catch(t){console.error("Unable to load libraries",t)}}()}),[]),n=Object(a.useRef)(e);return{onLibraryChange:Object(a.useCallback)((function(e){!function(e){var n=JSON.stringify(e);localStorage.setItem("claymate-libraries",n)}(e),n.current=e}),[]),libraryItems:n.current}},R=function(){var e=Object(a.useRef)(null),n=D(),t=n.moveToScene,r=n.addScene,o=n.onChange,l=n.drawingVersion,u=n.currentIndex,d=n.initialData,m=n.scenes,f=n.updateScenes,g=M(),b=g.onLibraryChange,p=g.libraryItems,v=Object(a.useMemo)((function(){return p?Object(c.a)(Object(c.a)({},d),{},{libraryItems:p}):d}),[d,p]);return i.a.createElement("div",{className:"ClaymateApp"},i.a.createElement(s.a,{ref:e,key:l,initialData:v,onChange:o,onLibraryChange:b}),i.a.createElement(T,{scenes:m,currentIndex:u,updateScenes:f,moveToScene:t,addScene:r,updateDrawing:function(n){var t;null===(t=e.current)||void 0===t||t.updateScene(n)}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},42:function(e,n,t){e.exports=t(141)},47:function(e,n,t){},71:function(e,n,t){},72:function(e,n,t){},73:function(e,n,t){}},[[42,1,2]]]);
//# sourceMappingURL=main.b5963e2f.chunk.js.map